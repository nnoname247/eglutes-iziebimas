<!doctype html>
<html lang="lt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Modernus Įžiebimas</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f1724; 
      --accent: #8be9fd; 
      --accent2:#7c4dff; 
      --success:#54e346;
    }
    *{box-sizing:border-box;font-family:Inter,system-ui,sans-serif;-webkit-tap-highlight-color: transparent;}
    .stage, .tree, .branch, .trunk, .bulb, .placed-orn {
      user-select:none;-webkit-user-select:none;
    }
    
    html,body{
      height:100%; margin:0; overflow:hidden;
      background:linear-gradient(180deg,#050b1a 0%, #08142a 100%);
      color:#e6eef8;
    }

    .wrap{
      height:100%; width:100%;
      display:flex; align-items:center; justify-content:center;
      padding:16px;
    }
    
    .card{
      width:950px; max-width:100%; 
      height:auto; max-height:100%;
      background:linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      border-radius:20px; padding:20px;
      box-shadow:0 10px 40px rgba(0,0,0,0.5);
      border:1px solid rgba(255,255,255,0.08);
      
      display:flex; flex-direction:row; gap:20px;
      overflow-y:auto; 
    }

    /* Kairė pusė - Eglutė */
    .stage{
      flex:1;
      background:rgba(0,0,0,0.3);
      border-radius:16px;
      padding:10px;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      position:relative;
      min-height:300px;
    }
    
    .tree-zone{position:relative;width:240px;height:320px;display:flex;justify-content:center;align-items:flex-end; transform-origin: bottom center;}
    .tree{width:220px;height:300px;position:relative;z-index:1}
    
    .branch{position:absolute;left:50%;transform:translateX(-50%);width:0;height:0;border-left:110px solid transparent;border-right:110px solid transparent;filter:drop-shadow(0 10px 10px rgba(0,0,0,0.5))}
    .b1{top:10px;border-bottom:90px solid #1a5c30;z-index:3}
    .b2{top:80px;border-bottom:100px solid #144a25;z-index:2}
    .b3{top:160px;border-bottom:120px solid #0f3b1d;z-index:1}
    .trunk{position:absolute;left:50%;transform:translateX(-50%);bottom:-10px;width:34px;height:40px;background:#3e2312;border-radius:4px}

    /* Ryškios lemputės */
    .bulb{
      position:absolute; width:8px; height:8px; border-radius:50%; 
      background:#333; z-index:4; 
      transition:all 0.4s ease-out;
    }
    .bulb.on{
      box-shadow: 0 0 4px #fff, 0 0 12px currentColor, 0 0 25px currentColor, 0 0 40px currentColor; 
      animation: pulseLight 1.5s infinite alternate ease-in-out;
    }
    @keyframes pulseLight { 0%{opacity:0.85; transform:scale(1)} 100%{opacity:1; transform:scale(1.25)} }

    /* Žaisliukai ant eglutės */
    .placed-orn{
      position:absolute; width:22px; height:22px; border-radius:50%; z-index:5;
      box-shadow:0 3px 8px rgba(0,0,0,0.6);
      transform:scale(0); animation:popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
      border:1px solid rgba(255,255,255,0.3);
    }
    @keyframes popIn{to{transform:scale(1)}}

    /* Paletė apačioje */
    .palette-area{
      width:100%; margin-top:auto; padding-top:10px;
      display:flex; flex-direction:column; align-items:center; gap:8px;
      transition: opacity 0.5s;
    }
    .ornament-palette{display:flex; gap:12px; justify-content:center; flex-wrap:wrap;}
    .orn{
      width:44px; height:44px; border-radius:50%;
      cursor:pointer; transition:transform 0.2s;
      border:2px solid rgba(255,255,255,0.15);
      position:relative;
      touch-action: none;
    }
    .orn:active{transform:scale(0.9)}
    .orn.used{opacity:0.2;pointer-events:none;filter:grayscale(1)}
    .orn.dragging{opacity:0.5;transform:scale(1.1)}

    /* Tempimo kopija */
    .drag-ghost{
      position:fixed;
      width:44px; height:44px;
      border-radius:50%;
      pointer-events:none;
      z-index:10000;
      opacity:0.8;
      transform:translate(-50%, -50%);
      box-shadow:0 8px 20px rgba(0,0,0,0.6);
      border:2px solid rgba(255,255,255,0.3);
    }

    /* Pabaigos žinutė po eglute */
    .final-message-container {
      margin-top: 15px;
      min-height: 40px;
      text-align: center;
      display: flex; align-items: center; justify-content: center;
    }
    .final-msg {
      font-size: 16px; color: #ffd700; font-weight: 700;
      opacity: 0; transform: translateY(10px); transition: all 1s ease;
      text-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
      line-height: 1.4;
    }
    .final-msg.visible { opacity: 1; transform: translateY(0); }

    /* Dešinė pusė - Valdymas */
    .panel{
      flex:0.8; display:flex; flex-direction:column; 
      justify-content:flex-start; align-items:center; gap:20px; text-align:center; padding-top: 20px;
    }
    
    .panel h1{font-size:24px; margin:0; line-height:1.3; background: linear-gradient(to right, #fff, #bcd9ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent;}
    .panel p.lead{font-size:14px; color:#bcd9ffaa; margin:0}

    /* Mygtukas su SVG ikona */
    .power-btn{
      width:110px; height:110px; border-radius:50%;
      background:radial-gradient(circle, #1e2a45, #0b1221);
      border:4px solid rgba(255,255,255,0.08);
      display:flex; align-items:center; justify-content:center;
      cursor:pointer; position:relative; overflow:hidden;
      box-shadow:0 15px 35px rgba(0,0,0,0.4);
      transition: transform 0.2s, box-shadow 0.3s;
      margin-top: 20px;
      touch-action: manipulation;
    }
    .power-btn.locked{opacity:0.5; filter:grayscale(0.8);}
    .power-btn:active:not(.locked){transform:scale(0.94)}
    
    .power-icon{
      width: 50px;
      height: 50px;
      z-index:2;
      transition: all 0.3s;
      fill: var(--accent);
      filter: drop-shadow(0 0 8px var(--accent));
    }
    
    .progress-fill{
      position:absolute; bottom:0; left:0; width:100%; height:0%;
      background:linear-gradient(0deg, var(--accent2), var(--accent));
      opacity:0.4; z-index:1; transition: height 0.1s;
    }
    .power-btn.charging .progress-fill { height: 100%; transition: height 2s linear; opacity: 0.9; }
    
    body.lights-on .power-btn { box-shadow: 0 0 60px var(--accent2); border-color:#fff; }
    body.lights-on .power-icon { 
      fill: #fff;
      filter: drop-shadow(0 0 20px #fff);
    }

    /* Snaigės */
    #snow-layer {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      overflow: hidden;
      z-index: 9999;
      opacity: 0;
      transition: opacity 1s;
    }
    #snow-layer.visible { opacity: 1; }
    .snowflake {
      position: absolute;
      color: white;
      top: -50px;
      opacity: 0.85;
      pointer-events: none;
      will-change: transform;
      animation: fall linear infinite;
    }
    @keyframes fall {
      0% { transform: translateY(0) rotate(0deg); }
      100% { transform: translateY(calc(100vh + 100px)) rotate(360deg); }
    }

    /* Mobile */
    @media (max-width: 850px) {
      .card{ flex-direction: column; padding: 16px; gap: 16px; }
      .stage{ flex:none; padding-bottom: 20px; }
      .tree-zone{ transform: scale(0.95); height: 300px; }
      .panel{ flex:none; gap: 16px; padding-top:0;}
      .panel h1 { font-size: 20px; }
      .power-btn{ width:90px; height:90px; margin-top: 10px; }
      .power-icon { width: 40px; height: 40px; }
      .orn{width:42px; height:42px;}
      .drag-ghost{width:42px; height:42px;}
    }
  </style>
</head>
<body>
  <!-- Snaigių sluoksnis -->
  <div id="snow-layer"></div>

  <div class="wrap">
    <div class="card">
      
      <div class="stage" id="dropZone">
        <div class="tree-zone">
          <div class="tree" id="tree">
            <div class="branch b1"></div>
            <div class="branch b2"></div>
            <div class="branch b3"></div>
            <div class="trunk"></div>
            
            <div id="lights-container"></div>
            <div id="ornaments-container"></div>
          </div>
        </div>

        <div class="final-message-container">
            <div class="final-msg" id="finalMsg">
                O dabar įžiebk ne moderniąją,<br>o tikrąją eglutę! ✨
            </div>
        </div>

        <div class="palette-area" id="paletteArea">
          <div style="font-size:12px;color:#8be9fd;opacity:0.7;margin-bottom:4px">Tempk arba spausk (5 vnt.)</div>
          <div class="ornament-palette">
            <div class="orn" draggable="true" id="o1" data-color="#ff4757" style="background:radial-gradient(circle at 30% 30%, #ff6b81, #c4001d);"></div>
            <div class="orn" draggable="true" id="o2" data-color="#ffa502" style="background:radial-gradient(circle at 30% 30%, #ffd32a, #ff9f1a);"></div>
            <div class="orn" draggable="true" id="o3" data-color="#2ed573" style="background:radial-gradient(circle at 30% 30%, #7bed9f, #26af61);"></div>
            <div class="orn" draggable="true" id="o4" data-color="#1e90ff" style="background:radial-gradient(circle at 30% 30%, #70a1ff, #1e90ff);"></div>
            <div class="orn" draggable="true" id="o5" data-color="#a55eea" style="background:radial-gradient(circle at 30% 30%, #d980fa, #a55eea);"></div>
          </div>
        </div>
      </div>

      <div class="panel">
        <div>
          <h1>Modernus Kalėdų Senelis kviečia į modernų įžiebimą</h1>
          <p class="lead" style="margin-top:10px">1. Papuošk eglutę 5 žaisliukais.<br>2. Palaikyk mygtuką, kol įsikraus.</p>
        </div>

        <div class="power-btn locked" id="powerBtn">
          <div class="progress-fill"></div>
          <svg class="power-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M13 3h-2v10h2V3zm4.83 2.17l-1.42 1.42C17.99 7.86 19 9.81 19 12c0 3.87-3.13 7-7 7s-7-3.13-7-7c0-2.19 1.01-4.14 2.58-5.42L6.17 5.17C4.23 6.82 3 9.26 3 12c0 4.97 4.03 9 9 9s9-4.03 9-9c0-2.74-1.23-5.18-3.17-6.83z"/>
          </svg>
        </div>

        <div style="text-align:center">
          <div id="statusText" style="font-weight:700;color:#888;font-size:14px">Laukiama papuošimų...</div>
        </div>
      </div>

    </div>
  </div>

<script>
  const ornContainer = document.getElementById('ornaments-container');
  const lightsContainer = document.getElementById('lights-container');
  const orns = document.querySelectorAll('.orn');
  const powerBtn = document.getElementById('powerBtn');
  const statusText = document.getElementById('statusText');
  const dropZone = document.getElementById('dropZone');
  const finalMsg = document.getElementById('finalMsg');
  const paletteArea = document.getElementById('paletteArea');
  const snowLayer = document.getElementById('snow-layer');
  const treeElement = document.getElementById('tree');

  let placedCount = 0;
  const totalRequired = 5;
  let isUnlocked = false;
  let isPoweredOn = false;
  let chargeTimer = null;

  // Drag state
  let dragGhost = null;
  let currentDragOrn = null;
  let isDragging = false;

  // 1. GENERUOJAM RYŠKIAS LEMPUTES
  const bulbPositions = [
    {top: 40, left: 105}, {top: 70, left: 90}, {top: 75, left: 125},
    {top: 110, left: 70}, {top: 120, left: 110}, {top: 115, left: 150},
    {top: 160, left: 50}, {top: 170, left: 90}, {top: 165, left: 130}, {top: 175, left: 170},
    {top: 200, left: 30}, {top: 210, left: 75}, {top: 220, left: 120}, {top: 215, left: 160}
  ];

  bulbPositions.forEach(pos => {
    const b = document.createElement('div');
    b.className = 'bulb';
    b.style.top = pos.top + 'px';
    b.style.left = pos.left + 'px';
    const colors = ['#ff0055', '#ffe600', '#00ffaa', '#00ccff', '#aa00ff'];
    b.style.color = colors[Math.floor(Math.random()*colors.length)];
    lightsContainer.appendChild(b);
  });

  // 2. ŽAISLIUKŲ DĖJIMAS
  const placeOrnament = (ornElement, x, y) => {
    if(ornElement.classList.contains('used')) return;
    
    ornElement.classList.add('used');
    
    const newOrn = document.createElement('div');
    newOrn.className = 'placed-orn';
    newOrn.style.background = ornElement.dataset.color;
    
    // Jei turime koordinates (drag), naudojam jas
    if(x !== undefined && y !== undefined) {
      const treeRect = treeElement.getBoundingClientRect();
      const relX = x - treeRect.left;
      const relY = y - treeRect.top;
      newOrn.style.left = relX - 11 + 'px';
      newOrn.style.top = relY - 11 + 'px';
    } else {
      // Atsitiktinė vieta (click)
      const ornY = 50 + Math.random() * 180;
      const widthAtY = ornY * 0.6; 
      const ornX = 110 + (Math.random() * widthAtY - widthAtY/2) - 11;
      newOrn.style.top = ornY + 'px';
      newOrn.style.left = ornX + 'px';
    }
    
    ornContainer.appendChild(newOrn);
    placedCount++;
    checkStatus();
  };

  // 3. DESKTOP DRAG & DROP
  orns.forEach(o => {
    o.addEventListener('dragstart', (e) => { 
      e.dataTransfer.setData('id', o.id);
      e.dataTransfer.effectAllowed = 'move';
    });
  });

  dropZone.addEventListener('dragover', e => e.preventDefault());
  dropZone.addEventListener('drop', e => {
    e.preventDefault();
    const id = e.dataTransfer.getData('id');
    const el = document.getElementById(id);
    if(el && !el.classList.contains('used')) {
      placeOrnament(el, e.clientX, e.clientY);
    }
  });

  // 4. MOBILE TOUCH DRAG
  orns.forEach(o => {
    let touchStartX, touchStartY;
    let hasMoved = false;

    o.addEventListener('touchstart', (e) => {
      if(o.classList.contains('used')) return;
      
      const touch = e.touches[0];
      touchStartX = touch.clientX;
      touchStartY = touch.clientY;
      hasMoved = false;
      isDragging = false;
      currentDragOrn = o;

      // Sukuriam ghost po truputį
      setTimeout(() => {
        if(currentDragOrn === o && !hasMoved) {
          createDragGhost(o, touch.clientX, touch.clientY);
          isDragging = true;
          o.classList.add('dragging');
        }
      }, 100);
    }, {passive: true});

    o.addEventListener('touchmove', (e) => {
      if(!currentDragOrn || currentDragOrn !== o) return;
      
      const touch = e.touches[0];
      const deltaX = Math.abs(touch.clientX - touchStartX);
      const deltaY = Math.abs(touch.clientY - touchStartY);
      
      if(deltaX > 5 || deltaY > 5) {
        hasMoved = true;
      }

      if(isDragging && dragGhost) {
        e.preventDefault();
        dragGhost.style.left = touch.clientX + 'px';
        dragGhost.style.top = touch.clientY + 'px';
      }
    }, {passive: false});

    o.addEventListener('touchend', (e) => {
      if(currentDragOrn !== o) return;

      if(isDragging && dragGhost) {
        e.preventDefault();
        const touch = e.changedTouches[0];
        
        // Patikrinam ar ant eglutės
        const treeRect = treeElement.getBoundingClientRect();
        if(touch.clientX >= treeRect.left && touch.clientX <= treeRect.right &&
           touch.clientY >= treeRect.top && touch.clientY <= treeRect.bottom) {
          placeOrnament(o, touch.clientX, touch.clientY);
        }
        
        removeDragGhost();
        o.classList.remove('dragging');
      } else if(!hasMoved) {
        // Paprastas tap
        placeOrnament(o);
      }

      currentDragOrn = null;
      isDragging = false;
    });

    o.addEventListener('touchcancel', () => {
      if(currentDragOrn === o) {
        removeDragGhost();
        o.classList.remove('dragging');
        currentDragOrn = null;
        isDragging = false;
      }
    });
  });

  function createDragGhost(ornElement, x, y) {
    dragGhost = document.createElement('div');
    dragGhost.className = 'drag-ghost';
    dragGhost.style.background = ornElement.style.background;
    dragGhost.style.left = x + 'px';
    dragGhost.style.top = y + 'px';
    document.body.appendChild(dragGhost);
  }

  function removeDragGhost() {
    if(dragGhost) {
      dragGhost.remove();
      dragGhost = null;
    }
  }

  function checkStatus() {
    if(placedCount >= totalRequired) {
      isUnlocked = true;
      powerBtn.classList.remove('locked');
      statusText.textContent = "Paruošta – Palaikyk mygtuką";
      statusText.style.color = "#fff";
      if(navigator.vibrate) navigator.vibrate(50);
    } else {
      statusText.textContent = `Dar trūksta: ${totalRequired - placedCount}`;
    }
  }

  // 5. ĮJUNGIMAS
  const startCharge = (e) => {
    if(!isUnlocked || isPoweredOn) return;
    e.preventDefault(); 
    powerBtn.classList.add('charging');
    chargeTimer = setTimeout(turnOnLights, 2000); 
  };

  const stopCharge = (e) => {
    if(e) e.preventDefault();
    if(isPoweredOn) return;
    powerBtn.classList.remove('charging');
    clearTimeout(chargeTimer);
  };

  const turnOnLights = () => {
    isPoweredOn = true;
    document.body.classList.add('lights-on');
    powerBtn.classList.remove('charging');
    
    statusText.textContent = "EGLUTĖ ĮŽIEBTA!";
    statusText.style.color = "#54e346";
    
    paletteArea.style.opacity = '0';
    paletteArea.style.pointerEvents = 'none';

    setTimeout(() => {
        finalMsg.classList.add('visible');
    }, 500);

    // Lemputės
    document.querySelectorAll('.bulb').forEach((b) => {
      setTimeout(() => { b.classList.add('on'); }, Math.random() * 800);
    });

    // Snaigės
    snowLayer.classList.add('visible');
    for(let i = 0; i < 50; i++) {
      setTimeout(createSnowflake, i * 80);
    }
    setInterval(createSnowflake, 300);

    if(navigator.vibrate) navigator.vibrate([100,50,100]);
  };

  function createSnowflake() {
    const flake = document.createElement('div');
    flake.classList.add('snowflake');
    const symbols = ['❄','❅','❆','✦'];
    flake.innerHTML = symbols[Math.floor(Math.random() * symbols.length)];
    flake.style.left = Math.random() * 100 + 'vw';
    flake.style.fontSize = (12 + Math.random() * 18) + 'px';
    flake.style.animationDuration = (4 + Math.random() * 4) + 's';
    snowLayer.appendChild(flake);
    setTimeout(() => flake.remove(), 9000);
  }

  // Mygtuko įvykiai
  powerBtn.addEventListener('mousedown', startCharge);
  powerBtn.addEventListener('touchstart', startCharge, {passive: false});
  powerBtn.addEventListener('mouseup', stopCharge);
  powerBtn.addEventListener('mouseleave', stopCharge);
  powerBtn.addEventListener('touchend', stopCharge);
  powerBtn.addEventListener('touchcancel', stopCharge);
</script>
</body>
</html>